<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI ê¸€ì“°ê¸° ì¹œêµ¬</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
      body {
        font-family: 'Noto Sans KR', sans-serif;
      }
    </style>
  <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@18.3.1",
    "react-dom/client": "https://esm.sh/react-dom@18.3.1/client",
    "@google/generative-ai": "https://esm.sh/@google/generative-ai@0.11.3"
  }
}
</script>
</head>
  <body>
    <div id="root"></div>
    <script type="module">
      import React, { useState, useRef, useCallback } from 'react';
      import ReactDOM from 'react-dom/client';
      import { GoogleGenerativeAI } from "@google/generative-ai";

      // --- Gemini API ì„œë¹„ìŠ¤ ì„¤ì • ---
      // ì¤‘ìš”: 'YOUR_API_KEY' ë¶€ë¶„ì„ ì‹¤ì œ ë°œê¸‰ë°›ì€ Google AI Studio API í‚¤ë¡œ ë³€ê²½í•´ì£¼ì„¸ìš”.
      const API_KEY = ''; 
      const genAI = new GoogleGenerativeAI(API_KEY);

      async function fetchFeedback(topic, writing) {
        const model = genAI.getGenerativeModel({ model: "gemini-1.5-flash"});

        const prompt = `
          ë‹¹ì‹ ì€ í•œêµ­ ì´ˆë“±í•™ìƒë“¤ì„ ìœ„í•œ ì¹œì ˆí•˜ê³  ê²©ë ¤í•˜ëŠ” ê¸€ì“°ê¸° ì„ ìƒë‹˜ì…ë‹ˆë‹¤. ë‹¹ì‹ ì˜ í”¼ë“œë°±ì€ ì´í•´í•˜ê¸° ì‰½ê³ , ê¸ì •ì ì´ì–´ì•¼ í•˜ë©°, í•™ìƒë“¤ì´ ìì‹ ì˜ ìƒê°ì„ ë” ì˜ í‘œí˜„í•  ìˆ˜ ìˆë„ë¡ ë•ëŠ” ë° ì¤‘ì ì„ ë‘ì–´ì•¼ í•©ë‹ˆë‹¤. í•­ìƒ í•œêµ­ì–´ë¡œ ì‘ì„±í•´ì£¼ì„¸ìš”.

          ë‹¤ìŒì€ í•™ìƒì´ ì‘ì„±í•œ ê¸€ì…ë‹ˆë‹¤. ì•„ë˜ ì§€ì¹¨ì— ë”°ë¼ í”¼ë“œë°±ì„ ìƒì„±í•´ì£¼ì„¸ìš”.

          **ì§€ì¹¨:**
          1.  **ë§¤ìš° ì¹œì ˆí•˜ê³  ê¸ì •ì ì¸ í†¤**ìœ¼ë¡œ ì¹­ì°¬ì„ ë¨¼ì € í•´ì£¼ì„¸ìš”. í•™ìƒì˜ ë…¸ë ¥ì„ ì¸ì •í•´ì£¼ì„¸ìš”.
          2.  í”¼ë“œë°±ì€ ì´ˆë“±í•™ìƒì´ ì´í•´í•˜ê¸° ì‰¬ìš´ ë‹¨ì–´ì™€ ë¬¸ì¥ìœ¼ë¡œ ì‘ì„±í•´ì£¼ì„¸ìš”. ì–´ë ¤ìš´ ì „ë¬¸ ìš©ì–´ëŠ” í”¼í•´ì£¼ì„¸ìš”.
          3.  ê°€ì¥ ì¤‘ìš”í•œ ê²ƒì€ **'ìì‹ ì˜ ìƒê°ì„ í‘œí˜„í•˜ëŠ” í˜'**ì„ ê¸¸ëŸ¬ì£¼ëŠ” ë° ì´ˆì ì„ ë§ì¶°ì£¼ì„¸ìš”. "ì™œ ê·¸ë ‡ê²Œ ìƒê°í–ˆì–´?", "ê·¸ë•Œ ê¸°ë¶„ì€ ì–´ë• ì–´?" ì™€ ê°™ì€ ì§ˆë¬¸ì„ í†µí•´ ë” ê¹Šì€ ìƒê°ì„ ìœ ë„í•´ì£¼ì„¸ìš”.
          4.  ê¸€ì˜ **ì£¼ì œ ê´€ë ¨ì„±**ê³¼ **ì°½ì˜ì„±**ë„ í•¨ê»˜ ë¶„ì„í•˜ì—¬ ì¹­ì°¬ê³¼ ê²©ë ¤ì˜ ìš”ì†Œë¡œ í™œìš©í•´ì£¼ì„¸ìš”.
          5.  í”¼ë“œë°±ì€ Markdownì„ ì‚¬ìš©í•˜ì—¬ ë‹¤ìŒ ì„¸ ë¶€ë¶„ìœ¼ë¡œ ëª…í™•í•˜ê²Œ êµ¬ì„±í•´ì£¼ì„¸ìš”:
              *   ### ğŸŒŸ ì¹­ì°¬í•´ìš”!
                  ê¸€ì—ì„œ ì˜í•œ ì ì„ 2~3ê°€ì§€ êµ¬ì²´ì ìœ¼ë¡œ ì¹­ì°¬í•´ì£¼ì„¸ìš”. (ì˜ˆ: "ì£¼ì œì— ë§ëŠ” ì¬ë¯¸ìˆëŠ” ìƒê°ì„ í–ˆêµ¬ë‚˜!", "ìì‹ ë§Œì˜ ê²½í—˜ì„ ì†”ì§í•˜ê²Œ í‘œí˜„í•œ ì ì´ ì •ë§ ë©‹ì ¸.")
              *   ### ğŸ¤” ìƒê° ë”í•˜ê¸°
                  ìì‹ ì˜ ìƒê°ì„ ë” ê¹Šê³  í’ë¶€í•˜ê²Œ í‘œí˜„í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì£¼ëŠ” ì§ˆë¬¸ì´ë‚˜ ì œì•ˆì„ 1~2ê°€ì§€ í•´ì£¼ì„¸ìš”. ì •ë‹µì„ ìš”êµ¬í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, í•™ìƒì˜ ìƒê°ì„ í™•ì¥ì‹œí‚¤ëŠ” ë° ëª©ì ì´ ìˆìŠµë‹ˆë‹¤. (ì˜ˆ: "ë§Œì•½ ì£¼ì¸ê³µì´ ë‹¤ë¥¸ ì„ íƒì„ í–ˆë‹¤ë©´ ì–´ë–»ê²Œ ë˜ì—ˆì„ê¹Œ?", "ê·¸ë•Œ ëŠê¼ˆë˜ ê°ì •ì„ ìƒ‰ê¹”ì´ë‚˜ ë‚ ì”¨ì— ë¹„ìœ í•´ë³¸ë‹¤ë©´ ì–´ë–¨ê¹Œ?")
              *   ### ğŸ’¡ ì´ë ‡ê²Œ í•´ë´ìš”!
                  ë‹¤ìŒì— ê¸€ì„ ì“¸ ë•Œ ì‹œë„í•´ë³¼ ë§Œí•œ êµ¬ì²´ì ì´ê³  ì‹¤ìš©ì ì¸ íŒì„ í•œ ê°€ì§€ ì•Œë ¤ì£¼ì„¸ìš”. (ì˜ˆ: "ê¸€ì„ ì“°ê¸° ì „ì— ë– ì˜¤ë¥´ëŠ” ìƒê°ë“¤ì„ ë™ê·¸ë¼ë¯¸ë¡œ ê·¸ë¦¬ê³  ì—°ê²°í•´ë³´ëŠ” 'ìƒê° ê·¸ë¬¼'ì„ ë§Œë“¤ì–´ë³´ë©´ ë„ì›€ì´ ë  ê±°ì•¼!", "ë„¤ê°€ ê°€ì¥ ì¢‹ì•„í•˜ëŠ” ë¬¸ì¥ì— ë” ìƒìƒí•œ í‘œí˜„ì„ ì¶”ê°€í•´ë³´ëŠ” ê±´ ì–´ë•Œ?")

          ---

          **ì£¼ì œ:** ${topic}

          **í•™ìƒì˜ ê¸€:**
          ${writing}
        `;

        try {
          const result = await model.generateContent(prompt);
          const response = await result.response;
          return response.text();
        } catch (error) {
          console.error("Error generating content:", error);
          throw new Error("Gemini APIì—ì„œ í”¼ë“œë°±ì„ ê°€ì ¸ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
        }
      }

      // --- ì•„ì´ì½˜ ì»´í¬ë„ŒíŠ¸ ---
      const DocumentArrowDownIcon = (props) => (
        React.createElement('svg', {
          xmlns: "http://www.w3.org/2000/svg",
          fill: "none",
          viewBox: "0 0 24 24",
          strokeWidth: 1.5,
          stroke: "currentColor",
          ...props
        }, React.createElement('path', {
          strokeLinecap: "round",
          strokeLinejoin: "round",
          d: "M9 12.75l3 3m0 0l3-3m-3 3v-7.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
        }))
      );

      // --- ë¡œë”© ìŠ¤í”¼ë„ˆ ì»´í¬ë„ŒíŠ¸ ---
      const Spinner = () => {
        return (
          React.createElement('div', {
            className: "inline-block h-5 w-5 animate-spin rounded-full border-4 border-solid border-current border-r-transparent align-[-0.125em] motion-reduce:animate-[spin_1.5s_linear_infinite]",
            role: "status"
          }, React.createElement('span', {
            className: "!absolute !-m-px !h-px !w-px !overflow-hidden !whitespace-nowrap !border-0 !p-0 ![clip:rect(0,0,0,0)]"
          }, "Loading..."))
        );
      };
      
      // --- ë§ˆí¬ë‹¤ìš´ ë Œë”ëŸ¬ ì»´í¬ë„ŒíŠ¸ ---
      const MarkdownRenderer = ({ text }) => {
        const createMarkup = (rawText) => {
            const html = rawText
                .replace(/### (.*)/g, '<h3 class="font-bold text-xl mt-4 mb-2">$1</h3>')
                .replace(/\* (.*)/g, '<li class="ml-5 list-disc">$1</li>')
                .replace(/\n/g, '<br />');
            return { __html: html };
        };
        return React.createElement('div', { dangerouslySetInnerHTML: createMarkup(text) });
      };

      // --- í”¼ë“œë°± ì¹´ë“œ ì»´í¬ë„ŒíŠ¸ ---
      const FeedbackCard = ({ topic, writing, feedback }) => {
        return (
          React.createElement('div', { className: "mt-10 border-t-2 border-sky-200 pt-8" },
            React.createElement('div', { className: "bg-amber-50 border-2 border-amber-200 p-6 rounded-xl mb-8" },
              React.createElement('h2', { className: "text-2xl font-bold text-amber-800 mb-4" }, "ğŸ“ ë‚´ê°€ ì“´ ê¸€"),
              React.createElement('div', null,
                React.createElement('h3', { className: "font-bold text-lg text-gray-700" }, `ì£¼ì œ: ${topic}`),
                React.createElement('p', { className: "mt-2 text-gray-600 whitespace-pre-wrap" }, writing)
              )
            ),
            React.createElement('div', { className: "bg-teal-50 border-2 border-teal-200 p-6 rounded-xl" },
              React.createElement('h2', { className: "text-2xl font-bold text-teal-800 mb-4" }, "ğŸ¤– AI ì„ ìƒë‹˜ì˜ í”¼ë“œë°±"),
              React.createElement('div', { className: "prose prose-lg max-w-none text-gray-700" },
                React.createElement(MarkdownRenderer, { text: feedback })
              )
            )
          )
        );
      };

      // --- ë©”ì¸ ì•± ì»´í¬ë„ŒíŠ¸ ---
      const App = () => {
        const [topic, setTopic] = useState('');
        const [writing, setWriting] = useState('');
        const [feedback, setFeedback] = useState('');
        const [isLoading, setIsLoading] = useState(false);
        const [error, setError] = useState(null);

        const feedbackRef = useRef(null);

        const handleSubmit = async (e) => {
          e.preventDefault();
          if (!topic.trim() || !writing.trim()) {
            setError('ì£¼ì œì™€ ê¸€ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            return;
          }

          setIsLoading(true);
          setError(null);
          setFeedback('');

          try {
            const result = await fetchFeedback(topic, writing);
            setFeedback(result);
          } catch (err) {
            setError('í”¼ë“œë°±ì„ ìƒì„±í•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            console.error(err);
          } finally {
            setIsLoading(false);
          }
        };

        const handlePdfExport = useCallback(() => {
          if (!feedbackRef.current) return;
          
          const { jsPDF } = window.jspdf;
          const content = feedbackRef.current;

          window.html2canvas(content, { scale: 2 }).then((canvas) => {
            const imgData = canvas.toDataURL('image/png');
            const pdf = new jsPDF('p', 'mm', 'a4');
            const pdfWidth = pdf.internal.pageSize.getWidth();
            const canvasWidth = canvas.width;
            const canvasHeight = canvas.height;
            const ratio = canvasWidth / canvasHeight;
            const imgWidth = pdfWidth - 20; // A4 ì—¬ë°± ê³ ë ¤
            const imgHeight = imgWidth / ratio;
            
            let heightLeft = imgHeight;
            let position = 10; // ìƒë‹¨ ì—¬ë°±
            
            pdf.addImage(imgData, 'PNG', 10, position, imgWidth, imgHeight);
            heightLeft -= (pdf.internal.pageSize.getHeight() - 20);

            while (heightLeft > 0) {
              position = -heightLeft + 10;
              pdf.addPage();
              pdf.addImage(imgData, 'PNG', 10, position, imgWidth, imgHeight);
              heightLeft -= (pdf.internal.pageSize.getHeight() - 20);
            }
            
            pdf.save('AI_ê¸€ì“°ê¸°_í”¼ë“œë°±.pdf');
          });
        }, []);

        const isFormIncomplete = !topic.trim() || !writing.trim();

        return (
          React.createElement('div', { className: "min-h-screen bg-sky-50 text-gray-800" },
            React.createElement('main', { className: "container mx-auto px-4 py-8" },
              React.createElement('header', { className: "text-center mb-10" },
                React.createElement('h1', { className: "text-4xl md:text-5xl font-bold text-sky-700" }, "AI ê¸€ì“°ê¸° ì¹œêµ¬ âœï¸"),
                React.createElement('p', { className: "mt-4 text-lg text-sky-600" }, "ë„ˆì˜ ìƒê°ì„ ë©‹ì§„ ê¸€ë¡œ ë§Œë“¤ì–´ë³´ì!")
              ),
              React.createElement('div', { className: "max-w-3xl mx-auto bg-white p-8 rounded-2xl shadow-lg" },
                React.createElement('form', { onSubmit: handleSubmit },
                  React.createElement('div', { className: "mb-6" },
                    React.createElement('label', { htmlFor: "topic", className: "block text-xl font-bold text-gray-700 mb-2" }, "ì£¼ì œ"),
                    React.createElement('input', {
                      id: "topic",
                      type: "text",
                      value: topic,
                      onChange: (e) => setTopic(e.target.value),
                      placeholder: "ê¸€ì“°ê¸° ì£¼ì œë¥¼ ì…ë ¥í•´ë´!",
                      className: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition duration-200"
                    })
                  ),
                  React.createElement('div', { className: "mb-8" },
                    React.createElement('label', { htmlFor: "writing", className: "block text-xl font-bold text-gray-700 mb-2" }, "ê¸€ì“°ê¸°"),
                    React.createElement('textarea', {
                      id: "writing",
                      value: writing,
                      onChange: (e) => setWriting(e.target.value),
                      placeholder: "ì£¼ì œì— ë§ì¶° ë„ˆì˜ ìƒê°ì„ ììœ ë¡­ê²Œ ì ì–´ë´!",
                      rows: 12,
                      className: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition duration-200"
                    })
                  ),
                  React.createElement('div', { className: "flex flex-col sm:flex-row gap-4" },
                    React.createElement('button', {
                      type: "submit",
                      disabled: isFormIncomplete || isLoading,
                      className: "w-full sm:w-auto flex-grow bg-sky-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-sky-700 transition-colors duration-300 disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center justify-center gap-2"
                    }, 
                      isLoading ? React.createElement(React.Fragment, null, React.createElement(Spinner, null), "AI ì„ ìƒë‹˜ì´ ì½ëŠ” ì¤‘...") : 'AI ì„ ìƒë‹˜ê»˜ ì œì¶œí•˜ê¸°'
                    ),
                    React.createElement('button', {
                      type: "button",
                      onClick: handlePdfExport,
                      disabled: !feedback,
                      className: "w-full sm:w-auto bg-teal-500 text-white font-bold py-3 px-6 rounded-lg hover:bg-teal-600 transition-colors duration-300 disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center justify-center gap-2"
                    }, 
                      React.createElement(DocumentArrowDownIcon, { className: "h-5 w-5" }),
                      "PDFë¡œ ì €ì¥í•˜ê¸°"
                    )
                  )
                ),
                error && React.createElement('div', { className: "mt-6 text-center text-red-600 bg-red-100 p-3 rounded-lg" }, error),
                React.createElement('div', { ref: feedbackRef },
                  feedback && React.createElement(FeedbackCard, { topic: topic, writing: writing, feedback: feedback })
                )
              ),
              React.createElement('footer', { className: "text-center mt-12 text-gray-500" },
                React.createElement('p', null, "Made with â¤ï¸ for young writers.")
              )
            )
          )
        );
      };

      // --- React ì•± ë Œë”ë§ ---
      const rootElement = document.getElementById('root');
      const root = ReactDOM.createRoot(rootElement);
      root.render(
        React.createElement(React.StrictMode, null, React.createElement(App, null))
      );
    </script>
  </body>

</html>
